
/* Interactive app for KUPA final */
async function loadJSON(path){ try{ const r = await fetch(path); return await r.json(); } catch(e){ console.error(e); return []; } }
function qs(s){ return document.querySelector(s); }
function qsa(s){ return Array.from(document.querySelectorAll(s)); }
function createElem(tag, attrs={}, inner=''){ const e=document.createElement(tag); for(const k in attrs) e.setAttribute(k, attrs[k]); if(inner) e.innerHTML = inner; return e; }
function profileCard(p){ const card=createElem('div',{class:'card profile'}); card.innerHTML = `<img src="${p.image}" alt="${p.name}"><div class="profile-meta"><h4>${p.name}</h4><div class="muted">${p.role}</div><p class="muted small">Source: <a href="${p.source}" target="_blank">link</a></p></div>`; return card; }
function newsCard(n){ const c=createElem('div',{class:'card'}); c.innerHTML = `<h4>${n.title}</h4><p class="muted">${n.source} · ${n.region||'all'}</p><p>${n.excerpt}</p><a class="btn btn-outline" href="${n.link}" target="_blank">Read</a>`; return c; }
function eventCard(e){ const c=createElem('div',{class:'card'}); c.innerHTML = `<h4>${e.title}</h4><p class="muted">${e.date} · ${e.location||''}</p><p>${e.description}</p>`; const btn=createElem('button',{class:'btn btn-primary'},'RSVP'); const id='rsvp_'+(e.title+e.date).replace(/\s+/g,'_'); if(localStorage.getItem(id)){ btn.textContent='RSVP’d ✓'; btn.disabled=true; } btn.addEventListener('click', ()=>{ localStorage.setItem(id,'1'); btn.textContent='RSVP’d ✓'; btn.disabled=true; }); c.appendChild(btn); return c; }
function marketCard(m){ const c=createElem('div',{class:'card'}); c.innerHTML = `<img class="market-img" src="${m.image}" alt="${m.title}"/><h4>${m.title}</h4><p class="muted">${m.price || ''} · ${m.location || ''}</p><p>${m.description}</p><div style="margin-top:8px"><button class="btn btn-primary buy-btn">Contact</button></div>`; c.querySelector('.buy-btn').addEventListener('click', ()=> alert('Contact seller: '+(m.contact || 'Not provided (prototype)'))); return c; }
async function boot(){ const profiles = await loadJSON('data/profiles.json'); const news = await loadJSON('data/news.json'); const events = await loadJSON('data/events.json'); const legends = await loadJSON('data/legends.json'); const market = await loadJSON('data/market.json'); qs('#stat-profiles').textContent = profiles.length; qs('#stat-events').textContent = events.length; qs('#stat-news').textContent = news.length; const slides = qs('#slides'), dots = qs('#dots'); slides.innerHTML=''; dots.innerHTML=''; const spotlight = profiles.slice(0,4).map(p=>({title:p.name,role:p.role,excerpt:p.bio,link:p.source})).concat(news.slice(0,2).map(n=>({title:n.title,role:n.source,excerpt:n.excerpt,link:n.link}))); spotlight.forEach((s,i)=>{ const div=createElem('div',{class:'slide'},`<h3>${s.title}</h3><p class='muted'>${s.role}</p><p>${s.excerpt}</p><a class='btn btn-outline' href='${s.link}' target='_blank'>View</a>`); slides.appendChild(div); const d=createElem('div',{class:'dot','data-i':i}); d.addEventListener('click', ()=> go(i)); dots.appendChild(d); }); let idx=0; function update(){ const w=qs('#spotlight').clientWidth; slides.style.transform = `translateX(-${idx*w}px)`; qsa('.dot').forEach(d=>d.classList.remove('active')); const active=qs('.dot[data-i="'+idx+'"]'); if(active) active.classList.add('active'); } function next(){ idx=(idx+1)%spotlight.length; update(); } function prev(){ idx=(idx-1+spotlight.length)%spotlight.length; update(); } function go(i){ idx=i; update(); } qs('#next').addEventListener('click', next); qs('#prev').addEventListener('click', prev); setInterval(next,4500); const pg = qs('#profiles-grid'); pg.innerHTML=''; profiles.forEach(p=> pg.appendChild(profileCard(p))); const cg = qs('#coaches-grid'); cg.innerHTML=''; profiles.filter(p=>p.is_coach).forEach(c=> cg.appendChild(profileCard(c))); const wg = qs('#women-grid'); wg.innerHTML=''; profiles.filter(p=> p.tags && p.tags.includes('women')).forEach(w=> wg.appendChild(profileCard(w))); const ng = qs('#news-grid'); function renderNews(filter='all', q=''){ ng.innerHTML=''; const filtered = news.filter(n=> (filter==='all'||n.region===filter) && (q==='' || (n.title+' '+n.excerpt).toLowerCase().includes(q.toLowerCase()))); if(filtered.length===0){ ng.innerHTML='<div class="card">No results</div>'; return;} filtered.forEach(n=> ng.appendChild(newsCard(n))); } renderNews('all',''); qs('#news-filter').addEventListener('change', e=> renderNews(e.target.value, qs('#news-search').value)); qs('#news-search').addEventListener('input', e=> renderNews(qs('#news-filter').value, e.target.value)); const eg = qs('#events-grid'); eg.innerHTML=''; events.forEach(ev=> eg.appendChild(eventCard(ev))); const lg = qs('#legends-grid'); lg.innerHTML=''; legends.forEach(l=> { const c=createElem('div',{class:'card'},`<h4>${l.name}</h4><p class='muted'>${l.type||''}</p><p>${l.story}</p><p class='muted small'>Source: ${l.source}</p>`); lg.appendChild(c); }); const mg = qs('#market-grid'); mg.innerHTML=''; market.forEach(m=> mg.appendChild(marketCard(m))); qs('#create-listing').addEventListener('click', ()=>{ const title = prompt('Listing title (e.g., Fresh maize sack)'); if(!title) return; const price = prompt('Price (e.g., KES 2000)'); const image = prompt('Image URL (paste a public image URL or leave blank)'); const desc = prompt('Short description'); const loc = prompt('Location (town/village)'); const contact = prompt('Contact (phone/email)'); const obj={title,price,description:desc,image:image||'assets/images/market.svg',location:loc,contact}; market.unshift(obj); localStorage.setItem('kupa_market', JSON.stringify(market)); mg.insertBefore(marketCard(obj), mg.firstChild); alert('Listing created (stored in browser for prototype).'); }); const saved = localStorage.getItem('kupa_market'); if(saved){ try{ const s = JSON.parse(saved); if(Array.isArray(s)){ s.forEach(m=> mg.insertBefore(marketCard(m), mg.firstChild)); } }catch(e){console.error(e);} } } setTimeout(()=> boot(), 300);
